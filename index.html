<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SniffAI ‚Äî –ü–æ–Ω—é—Ö–∞–π –∏ —Ä–∞—Å—Å–∫–∞–∂–∏</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }
    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 0 16px rgba(0, 0, 0, 0.1);
      padding: 2rem;
      max-width: 600px;
      width: 100%;
    }
    .input-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .composer-btn, .send-btn {
      border: none;
      background: none;
      cursor: pointer;
    }
    .send-btn {
      background: black;
      color: white;
      border-radius: 999px;
      height: 36px;
      width: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    textarea {
      flex-grow: 1;
      resize: none;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 0.5rem;
    }
    #output {
      margin-top: 1rem;
      white-space: pre-wrap;
      background: #fafafa;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #ddd;
    }
    input[type="file"], input[type="url"] {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üê∂ SniffAI</h1>
    <p>–ü–æ–∫–∞–∂–∏ –º–Ω–µ —á—Ç–æ-–Ω–∏–±—É–¥—å ‚Äî —è —Ä–∞—Å—Å–∫–∞–∂—É, –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç!</p>

    <input type="file" accept="image/*" id="imageInput"><br>
    <input type="url" placeholder="...–∏–ª–∏ –≤—Å—Ç–∞–≤—å URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" id="imageURLInput">

    <div class="input-row">
      <textarea id="question" rows="2" placeholder="–ß—Ç–æ —Ç—ã —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å?"></textarea>
      <button aria-label="–ö–Ω–æ–ø–∫–∞ –¥–∏–∫—Ç–æ–≤–∫–∏" type="button" class="composer-btn" id="micButton">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M11.165 4.41699C11.165 3.22048 10.1955 2.25018 8.99902 2.25C7.80241 2.25 6.83203 3.22038 6.83203 4.41699V8.16699C6.83221 9.36346 7.80252 10.333 8.99902 10.333C10.1954 10.3328 11.1649 9.36335 11.165 8.16699V4.41699Z" fill="currentColor"/>
          <path d="M14.8058 9.11426C14.4089 8.99623 13.9915 9.22244 13.8732 9.61914C13.2481 11.7194 11.3018 13.25 9.00011 13.25C6.69845 13.25 4.75214 11.7194 4.12706 9.61914C4.00876 9.22245 3.59126 8.99626 3.19444 9.11426C2.79744 9.23241 2.57141 9.65085 2.68956 10.0479C3.43005 12.5353 5.60114 14.4067 8.25011 14.707V15.75H6.91612C6.50191 15.75 6.16612 16.0858 6.16612 16.5C6.16612 16.9142 6.50191 17.25 6.91612 17.25H11.0831C11.5376 17.2078 11.8331 16.8884 11.8331 16.5C11.8331 16.1116 11.5376 15.7922 11.1593 15.7539L11.0831 15.75H9.75011V14.707C12.3991 14.4066 14.5702 12.5353 15.3107 10.0479C15.4288 9.65085 15.2028 9.23241 14.8058 9.11426Z" fill="currentColor"/>
        </svg>
      </button>
      <button id="sendButton" class="send-btn">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M7.99992 14.9993V5.41334L4.70696 8.70631C4.31643 9.09683 3.68342 9.09683 3.29289 8.70631C2.90237 8.31578 2.90237 7.68277 3.29289 7.29225L8.29289 2.29225C8.76184 1.90354 9.34084 1.92613 9.70696 2.29225L14.707 7.29225C15.0957 7.76119 15.0731 8.34019 14.707 8.70631C14.3408 9.07242 13.7618 9.09502 13.3691 8.77467L13.2929 8.70631L9.99992 5.41334V14.9993C9.99992 15.5516 9.55221 15.9993 8.99992 15.9993C8.44764 15.9993 7.99993 15.5516 7.99992 14.9993Z" fill="currentColor"/>
        </svg>
      </button>
    </div>

    <div id="output"></div>
  </div>

  <script>
    const sendButton = document.getElementById('sendButton');
    const micButton = document.getElementById('micButton');
    const questionInput = document.getElementById('question');
    const imageInput = document.getElementById('imageInput');
    const imageURLInput = document.getElementById('imageURLInput');
    const output = document.getElementById('output');

    let imageBlobUrl = null;

    micButton.onclick = () => {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'ru-RU';
      recognition.onresult = (e) => {
        questionInput.value = e.results[0][0].transcript;
      };
      recognition.start();
    };

    sendButton.onclick = async () => {
      const question = questionInput.value;
      let imageUrl = imageURLInput.value;

      if (!imageUrl && imageInput.files.length > 0) {
        const file = imageInput.files[0];
        imageBlobUrl = URL.createObjectURL(file);
        imageUrl = imageBlobUrl;
      }

      if (!question || !imageUrl) {
        output.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';
        return;
      }

      output.textContent = 'SniffAI –æ–±–Ω—é—Ö–∏–≤–∞–µ—Ç...';

      try {
        const res = await fetch('https://gulya-openrouter.maxim11393.workers.dev', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          model: 'qwen/qwen2.5-vl-32b-instruct:free',
          messages: [
            { role: 'system', content: '–¢—ã –Ω–µ–π—Ä–æ—Å–µ—Ç—å, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –ì—É–ª—è –¢–í.' },
            {
              role: 'user',
              content: [
                { type: 'text', text: question },
                { type: 'image_url', image_url: { url: imageUrl } }
              ]
            }
          ]
        })
      });

      const data = await res.json();
      output.textContent = data.choices?.[0]?.message?.content || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç';
    };
  </script>
</body>
</html>
